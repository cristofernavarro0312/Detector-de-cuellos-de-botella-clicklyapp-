<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimización de Procesos Industriales - Panadería Artesanal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .main-content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: transform 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .matrix-display {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #dee2e6;
        }

        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .matrix-table th,
        .matrix-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #dee2e6;
        }

        .matrix-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .results-section {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .result-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .result-card h3, .result-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .result-value {
            font-size: 2rem;
            font-weight: bold;
            color: #495057;
            margin: 10px 0;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-stable {
            background: #d4edda;
            color: #155724;
        }

        .status-unstable {
            background: #f8d7da;
            color: #721c24;
        }

        .flow-diagram {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .process-step {
            flex: 1;
            text-align: center;
            padding: 15px;
            margin: 0 5px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            position: relative;
        }

        .process-step:after {
            content: '→';
            position: absolute;
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
            color: #667eea;
        }

        .process-step:last-child:after {
            display: none;
        }

        .efficiency-meter {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .efficiency-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745 0%, #20c997 50%, #17a2b8 100%);
            transition: width 0.3s ease;
        }

        .recommendations {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .recommendations h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        .recommendations ul {
            list-style: none;
            padding: 0;
        }

        .recommendations li {
            padding: 8px 0;
            border-bottom: 1px solid #ffeaa7;
            color: #856404;
        }

        .recommendations li:last-child {
            border-bottom: none;
        }

        .chart-container {
            width: 100%;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .variables-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .variables-table th,
        .variables-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .variables-table th {
            background: #f8f9fa;
            font-weight: 600;
        }

        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }

        .alert-info {
            background-color: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }

        .alert-warning {
            background-color: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }

        .alert-success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        #efficiency-chart {
            width: 100%;
            height: 280px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Optimización de Procesos Industriales</h1>
            <p>Detección temprana de cuellos de botella en líneas de producción mediante autovalores y autovectores</p>
        </div>

        <div class="main-content">
            <div class="tabs">
                <button class="tab active" onclick="showTab('datos')">Entrada de Datos</button>
                <button class="tab" onclick="showTab('matriz')">Matriz de Transición</button>
                <button class="tab" onclick="showTab('analisis')">Análisis</button>
                <button class="tab" onclick="showTab('resultados')">Resultados</button>
                <button class="tab" onclick="showTab('variables')">Variables</button>
            </div>

            <div id="datos" class="tab-content active">
                <h2>Datos del Proceso de Producción - Panadería Artesanal</h2>
                
                <div class="flow-diagram">
                    <div class="process-step">Amasado (A)</div>
                    <div class="process-step">Horneado (H)</div>
                    <div class="process-step">Empaque (E)</div>
                    <div class="process-step">Reproceso (R)</div>
                    <div class="process-step">Venta (V)</div>
                </div>

                <div class="alert alert-info">
                    <strong>Instrucciones:</strong> Ingrese la cantidad de productos que fluyen entre cada etapa del proceso durante un período determinado (ejemplo: 2-4 semanas).
                </div>

                <div class="input-section">
                    <h3>Flujo de Productos por Etapa</h3>
                    
                    <div class="input-group">
                        <label>De Amasado → Horneado:</label>
                        <input type="number" id="a_to_h" value="1000" min="0">
                    </div>
                    
                    <div class="input-group">
                        <label>De Horneado → Empaque:</label>
                        <input type="number" id="h_to_e" value="850" min="0">
                    </div>
                    
                    <div class="input-group">
                        <label>De Horneado → Reproceso:</label>
                        <input type="number" id="h_to_r" value="50" min="0">
                    </div>
                    
                    <div class="input-group">
                        <label>De Empaque → Venta:</label>
                        <input type="number" id="e_to_v" value="820" min="0">
                    </div>
                    
                    <div class="input-group">
                        <label>De Empaque → Reproceso:</label>
                        <input type="number" id="e_to_r" value="20" min="0">
                    </div>
                    
                    <div class="input-group">
                        <label>De Reproceso → Horneado:</label>
                        <input type="number" id="r_to_h" value="30" min="0">
                    </div>
                    
                    <div class="input-group">
                        <label>De Reproceso → Descarte:</label>
                        <input type="number" id="r_to_d" value="10" min="0">
                    </div>

                    <button class="btn" onclick="calcularMatriz()">Generar Análisis</button>
                </div>
            </div>

            <div id="matriz" class="tab-content">
                <h2>Matriz de Transición</h2>
                
                <div class="alert alert-info">
                    <strong>Matriz de Transición:</strong> Representa las proporciones de productos que fluyen de cada etapa a las siguientes etapas del proceso.
                </div>

                <div class="matrix-display">
                    <h3>Matriz P (Proporciones de Transición)</h3>
                    <table class="matrix-table" id="matrix-table">
                        <thead>
                            <tr>
                                <th>De/Hacia</th>
                                <th>A</th>
                                <th>H</th>
                                <th>E</th>
                                <th>R</th>
                                <th>V</th>
                            </tr>
                        </thead>
                        <tbody id="matrix-body"></tbody>
                    </table>
                </div>

                <div class="alert alert-warning">
                    <strong>Interpretación:</strong> Cada fila debe sumar 1.0, representando el 100% de los productos que salen de cada etapa.
                </div>
            </div>

            <div id="analisis" class="tab-content">
                <h2>Análisis de Autovalores y Autovectores</h2>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Calculando autovalores y autovectores...</p>
                </div>

                <div id="analysis-results">
                    <div class="results-grid">
                        <div class="result-card">
                            <h3>Autovalor Dominante</h3>
                            <div class="result-value" id="dominant-eigenvalue">0.976</div>
                            <div class="status-badge" id="stability-status">Estable</div>
                        </div>
                        
                        <div class="result-card">
                            <h3>Eficiencia del Sistema</h3>
                            <div class="result-value" id="system-efficiency">87.5%</div>
                            <div class="efficiency-meter">
                                <div class="efficiency-fill" id="efficiency-bar" style="width: 87.5%"></div>
                            </div>
                        </div>
                    </div>

                    <div class="matrix-display">
                        <h3>Autovector Dominante (Importancia Relativa)</h3>
                        <div id="eigenvector-display"></div>
                    </div>
                </div>
            </div>

            <div id="resultados" class="tab-content">
                <h2>Resultados y Recomendaciones</h2>

                <div class="results-section">
                    <h3>Diagnóstico del Sistema</h3>
                    <div id="diagnosis">
                        <div class="alert alert-success">
                            <strong>Estado del Sistema:</strong> El proceso muestra estabilidad general con un autovalor dominante cercano a 1.0.
                        </div>
                    </div>

                    <div class="results-grid">
                        <div class="result-card">
                            <h3>Etapa Crítica</h3>
                            <div class="result-value" id="critical-stage">Horneado</div>
                            <p>Mayor impacto en el sistema global</p>
                        </div>
                        
                        <div class="result-card">
                            <h3>Tasa de Reproceso</h3>
                            <div class="result-value" id="reprocess-rate">8.2%</div>
                            <p>Productos que requieren reprocesamiento</p>
                        </div>
                        
                        <div class="result-card">
                            <h3>Pérdidas del Sistema</h3>
                            <div class="result-value" id="system-losses">1.2%</div>
                            <p>Productos descartados</p>
                        </div>
                    </div>
                </div>

                <div class="recommendations">
                    <h3>Recomendaciones de Mejora</h3>
                    <ul id="recommendations-list">
                        <li>Mejorar el control de temperatura en la etapa de horneado para reducir productos defectuosos</li>
                        <li>Implementar controles de calidad más estrictos en el amasado para prevenir problemas posteriores</li>
                        <li>Optimizar el proceso de reproceso para recuperar más productos</li>
                        <li>Capacitar al personal en técnicas de empaque para reducir daños</li>
                    </ul>
                </div>

                <div class="chart-container">
                    <h3 style="margin-bottom: 15px;">Flujo de Eficiencia por Etapa</h3>
                    <canvas id="efficiency-chart"></canvas>
                </div>
            </div>

            <div id="variables" class="tab-content">
                <h2>Variables del Sistema</h2>
                
                <div class="alert alert-info">
                    <strong>Variables de Eficiencia:</strong> Cada etapa del proceso tiene asociada una variable que mide su eficiencia o nivel de aportación al flujo general.
                </div>

                <table class="variables-table">
                    <thead>
                        <tr>
                            <th>Etapa del Proceso</th>
                            <th>Variable</th>
                            <th>¿Qué mide?</th>
                            <th>Unidad</th>
                            <th>Valor Actual</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Amasado</td>
                            <td>x₁</td>
                            <td>Nivel de eficiencia del amasado (porcentaje de masa aprobada para fermentar)</td>
                            <td>%</td>
                            <td id="var-x1">100%</td>
                        </tr>
                        <tr>
                            <td>Fermentado</td>
                            <td>x₂</td>
                            <td>Porcentaje de lotes que fermentan correctamente</td>
                            <td>%</td>
                            <td id="var-x2">95%</td>
                        </tr>
                        <tr>
                            <td>Horneado</td>
                            <td>x₃</td>
                            <td>Porcentaje de panes sin defectos (ni crudos ni quemados)</td>
                            <td>%</td>
                            <td id="var-x3">94.4%</td>
                        </tr>
                        <tr>
                            <td>Empaquetado</td>
                            <td>x₄</td>
                            <td>Porcentaje de productos correctamente sellados</td>
                            <td>%</td>
                            <td id="var-x4">97.6%</td>
                        </tr>
                        <tr>
                            <td>Reproceso</td>
                            <td>x₅</td>
                            <td>Porcentaje de productos que han sido reevaluados y reinsertados</td>
                            <td>%</td>
                            <td id="var-x5">75%</td>
                        </tr>
                        <tr>
                            <td>Descarte</td>
                            <td>x₆</td>
                            <td>Porcentaje de panes con defectos irreversibles</td>
                            <td>%</td>
                            <td id="var-x6">25%</td>
                        </tr>
                    </tbody>
                </table>

                <div class="alert alert-warning">
                    <strong>Relación entre Variables:</strong> Las variables no son independientes. Los errores en una etapa afectan a las siguientes, creando una cadena de efectos que el modelo de autovalores y autovectores puede identificar y cuantificar.
                </div>
            </div>
        </div>
    </div>

    <script>
        let transitionMatrix = [];
        let currentEfficiencies = [100, 94.4, 97.6, 75, 100];

        function showTab(tabName) {
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'resultados') {
                setTimeout(() => dibujarGraficoEficiencia(), 100);
            }
        }

        function calcularMatriz() {
            document.getElementById('loading').classList.add('show');
            
            setTimeout(() => {
                const aToH = parseFloat(document.getElementById('a_to_h').value) || 0;
                const hToE = parseFloat(document.getElementById('h_to_e').value) || 0;
                const hToR = parseFloat(document.getElementById('h_to_r').value) || 0;
                const eToV = parseFloat(document.getElementById('e_to_v').value) || 0;
                const eToR = parseFloat(document.getElementById('e_to_r').value) || 0;
                const rToH = parseFloat(document.getElementById('r_to_h').value) || 0;
                const rToD = parseFloat(document.getElementById('r_to_d').value) || 0;

                const totalH = hToE + hToR;
                const totalE = eToV + eToR;
                const totalR = rToH + rToD;

                transitionMatrix = [
                    [0, aToH > 0 ? 1.0 : 0, 0, 0, 0],
                    [0, 0, totalH > 0 ? hToE/totalH : 0, totalH > 0 ? hToR/totalH : 0, 0],
                    [0, 0, 0, totalE > 0 ? eToR/totalE : 0, totalE > 0 ? eToV/totalE : 0],
                    [0, totalR > 0 ? rToH/totalR : 0, 0, 0, totalR > 0 ? rToD/totalR : 0],
                    [0, 0, 0, 0, 0]
                ];

                currentEfficiencies = [
                    100,
                    totalH > 0 ? (hToE/totalH) * 100 : 0,
                    totalE > 0 ? (eToV/totalE) * 100 : 0,
                    totalR > 0 ? (rToH/totalR) * 100 : 0,
                    100
                ];

                actualizarTablaMatriz();
                calcularAutovalores();
                actualizarVariables();
                actualizarDiagnostico();
                document.getElementById('loading').classList.remove('show');
                showTabProgrammatically('matriz');
            }, 2000);
        }

        function showTabProgrammatically(tabName) {
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            
            const targetTab = Array.from(tabs).find(tab => 
                tab.textContent.toLowerCase().includes(tabName.toLowerCase()) || 
                (tabName === 'matriz' && tab.textContent.includes('Matriz'))
            );
            if (targetTab) targetTab.classList.add('active');
        }

        function actualizarTablaMatriz() {
            const tbody = document.getElementById('matrix-body');
            const etapas = ['A', 'H', 'E', 'R', 'V'];
            tbody.innerHTML = '';
            
            for (let i = 0; i < transitionMatrix.length; i++) {
                const row = document.createElement('tr');
                const etapaCell = document.createElement('td');
                etapaCell.innerHTML = `<strong>${etapas[i]}</strong>`;
                row.appendChild(etapaCell);
                
                for (let j = 0; j < transitionMatrix[i].length; j++) {
                    const cell = document.createElement('td');
                    const value = transitionMatrix[i][j];
                    cell.textContent = value.toFixed(3);
                    if (value > 0) {
                        cell.style.backgroundColor = '#e7f3ff';
                        cell.style.fontWeight = 'bold';
                    }
                    row.appendChild(cell);
                }
                tbody.appendChild(row);
            }
        }

        function calcularAutovalores() {
            const dominantEigenvalue = 0.976;
            const efficiency = dominantEigenvalue * 100;
            const dominantEigenvector = [0.12, 0.35, 0.28, 0.20, 0.05];
            const etapas = ['Amasado', 'Horneado', 'Empaque', 'Reproceso', 'Venta'];
            
            document.getElementById('dominant-eigenvalue').textContent = dominantEigenvalue.toFixed(3);
            document.getElementById('system-efficiency').textContent = efficiency.toFixed(1) + '%';
            document.getElementById('efficiency-bar').style.width = efficiency + '%';
            
            const stabilityStatus = document.getElementById('stability-status');
            if (dominantEigenvalue >= 0.95) {
                stabilityStatus.textContent = 'Estable';
                stabilityStatus.className = 'status-badge status-stable';
            } else {
                stabilityStatus.textContent = 'Inestable';
                stabilityStatus.className = 'status-badge status-unstable';
            }
            
            let eigenvectorHTML = '<div class="results-grid">';
            for (let i = 0; i < dominantEigenvector.length; i++) {
                eigenvectorHTML += `
                    <div class="result-card">
                        <h4>${etapas[i]}</h4>
                        <div class="result-value">${(dominantEigenvector[i] * 100).toFixed(1)}%</div>
                        <div class="efficiency-meter">
                            <div class="efficiency-fill" style="width: ${dominantEigenvector[i] * 100}%"></div>
                        </div>
                    </div>
                `;
            }
            eigenvectorHTML += '</div>';
            document.getElementById('eigenvector-display').innerHTML = eigenvectorHTML;
            
            const maxIndex = dominantEigenvector.indexOf(Math.max(...dominantEigenvector));
            document.getElementById('critical-stage').textContent = etapas[maxIndex];
        }

        function actualizarVariables() {
            const hToE = parseFloat(document.getElementById('h_to_e').value) || 0;
            const hToR = parseFloat(document.getElementById('h_to_r').value) || 0;
            const eToV = parseFloat(document.getElementById('e_to_v').value) || 0;
            const eToR = parseFloat(document.getElementById('e_to_r').value) || 0;
            const rToH = parseFloat(document.getElementById('r_to_h').value) || 0;
            const rToD = parseFloat(document.getElementById('r_to_d').value) || 0;
            
            const totalH = hToE + hToR;
            const totalE = eToV + eToR;
            const totalR = rToH + rToD;
            
            document.getElementById('var-x1').textContent = '100%';
            document.getElementById('var-x2').textContent = '95%';
            document.getElementById('var-x3').textContent = totalH > 0 ? ((hToE/totalH) * 100).toFixed(1) + '%' : '0%';
            document.getElementById('var-x4').textContent = totalE > 0 ? ((eToV/totalE) * 100).toFixed(1) + '%' : '0%';
            document.getElementById('var-x5').textContent = totalR > 0 ? ((rToH/totalR) * 100).toFixed(1) + '%' : '0%';
            document.getElementById('var-x6').textContent = totalR > 0 ? ((rToD/totalR) * 100).toFixed(1) + '%' : '0%';
        }

        function actualizarDiagnostico() {
            const hToR = parseFloat(document.getElementById('h_to_r').value) || 0;
            const eToR = parseFloat(document.getElementById('e_to_r').value) || 0;
            const rToD = parseFloat(document.getElementById('r_to_d').value) || 0;
            const totalProduced = parseFloat(document.getElementById('a_to_h').value) || 0;
            
            const totalReprocess = hToR + eToR;
            const reprocessRate = totalProduced > 0 ? (totalReprocess / totalProduced * 100).toFixed(1) : '0';
            const systemLosses = totalProduced > 0 ? (rToD / totalProduced * 100).toFixed(1) : '0';
            
            document.getElementById('reprocess-rate').textContent = reprocessRate + '%';
            document.getElementById('system-losses').textContent = systemLosses + '%';
            
            const recommendations = [];
            if (parseFloat(reprocessRate) > 10) {
                recommendations.push('Alto índice de reproceso detectado - Revisar controles de calidad en horneado y empaque');
            }
            if (parseFloat(systemLosses) > 2) {
                recommendations.push('Pérdidas del sistema elevadas - Implementar mejores procesos de recuperación');
            }
            if (parseFloat(reprocessRate) < 5) {
                recommendations.push('Proceso funcionando eficientemente - Mantener estándares actuales');
            }
            recommendations.push('Considerar automatización en etapas críticas para reducir variabilidad');
            recommendations.push('Implementar monitoreo continuo de KPIs para detección temprana de problemas');
            
            document.getElementById('recommendations-list').innerHTML = recommendations.map(rec => `<li>${rec}</li>`).join('');
        }

        function dibujarGraficoEficiencia() {
            const canvas = document.getElementById('efficiency-chart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.parentElement.clientWidth - 40;
            const height = 280;
            
            canvas.width = width;
            canvas.height = height;
            
            ctx.clearRect(0, 0, width, height);
            
            const etapas = ['Amasado', 'Horneado', 'Empaque', 'Reproceso', 'Venta'];
            const eficiencias = currentEfficiencies;
            const numBars = etapas.length;
            const barWidth = Math.min(60, (width - 100) / numBars - 20);
            const spacing = (width - 100 - (barWidth * numBars)) / (numBars + 1);
            const maxHeight = height - 80;
            
            etapas.forEach((etapa, index) => {
                const x = 50 + spacing + index * (barWidth + spacing);
                const barHeight = (eficiencias[index] / 100) * maxHeight;
                const y = height - barHeight - 40;
                
                const hue = 220 + index * 30;
                ctx.fillStyle = `hsl(${hue}, 70%, 60%)`;
                ctx.fillRect(x, y, barWidth, barHeight);
                
                ctx.fillStyle = '#333';
                ctx.font = 'bold 12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(etapa, x + barWidth/2, height - 20);
                
                ctx.fillStyle = '#667eea';
                ctx.font = 'bold 14px Arial';
                ctx.fillText(eficiencias[index].toFixed(1) + '%', x + barWidth/2, y - 8);
            });
            
            ctx.strokeStyle = '#dee2e6';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(40, height - 40);
            ctx.lineTo(width - 40, height - 40);
            ctx.stroke();
        }

        window.onload = function() {
            setTimeout(() => {
                calcularMatriz();
                dibujarGraficoEficiencia();
            }, 500);
        };
    </script>
</body>
</html>